/*
    uri-exploit.tst - Test HTML injection in URI
 */

const HTTP = tget('TM_HTTP') || "127.0.0.1:4100"
let http: Http = new Http

let caught
try {
    /* Http.get will throw for the bad url */
    http.get(HTTP + "/directives.esp?weather=sunny&exploit=<html>")
} catch {
    caught = true
}
ttrue(caught)
http.close()


//  Bypass http to send the request to the server
let s = new Socket
s.connect(HTTP)
s.write("GET /directives.esp?weather=sunny&exploit=<html> HTTP/1.0\r\n\r\n")
let response = new ByteArray
while ((n = s.read(response, -1)) != null) {}
ttrue(response.toString().contains('400 -- Bad Request'))
s.close()
